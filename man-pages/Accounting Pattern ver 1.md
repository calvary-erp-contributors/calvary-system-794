# Calvary ERP Treasury Module Accounting Model Documentation

## Introduction

This is the documentation for the accounting model in the Treasury module of Calvary ERP. This document provides an overview of the accounting model, its design principles, and its implementation details. The accounting model in Calvary ERP is inspired by the event sourcing pattern, as posited by Martin Fowler, and it shares similarities with the approach adopted in the [Book-Keeper](https://github.com/ghacupha/book-keeper) project by ghacupha.
The challenge with that particular project or the basic idea is that while implementation works out and illustrates a very real scenario for bootstrapping an entire banking system, it fails to illustrate how we can make the information persistent either with typical Data Mapper pattern or Active Record [persistence patterns](https://medium.com/@miladev95/php-orm-data-mapper-vs-active-record-61c096f3e093#id_token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjkzNGE1ODE2NDY4Yjk1NzAzOTUzZDE0ZTlmMTVkZjVkMDlhNDAxZTQiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiIyMTYyOTYwMzU4MzQtazFrNnFlMDYwczJ0cDJhMmphbTRsamRjbXMwMHN0dGcuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQiOiIyMTYyOTYwMzU4MzQtazFrNnFlMDYwczJ0cDJhMmphbTRsamRjbXMwMHN0dGcuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMDYwMTA4NDIxMjgxNjg3MjI5NDUiLCJlbWFpbCI6Im1haWxuamVydUBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmJmIjoxNzExODY3MTQ4LCJuYW1lIjoiRWR3aW4gTmplcnUiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EvQUNnOG9jTFk4blJ4UGNwZlBHeXBRUlpNaGxrUDRycGttNThKOHUwaU1IU1JFaU1PNTdnPXM5Ni1jIiwiZ2l2ZW5fbmFtZSI6IkVkd2luIiwiZmFtaWx5X25hbWUiOiJOamVydSIsImlhdCI6MTcxMTg2NzQ0OCwiZXhwIjoxNzExODcxMDQ4LCJqdGkiOiIyNTgzYWM3OWEyNjQ1OTU0YzJiNTM2Y2Y1YWMzZmI2YzU2MjAzMDZlIn0.NapGvDw-WHUnFicnjSbP8E50TOg7CFui-6ueH5bl_sVNyoFETphZiM9AYIGtos85WRBCet9Krwm10Y-jrlSwTtkTwv9Ze60ukmKoyYN7x7kPpb2AVGeLJEkAPmwvlpKuzSxft3vKSYlUInItKQ-jipIrhn4oJIrpq1N1Ex6TtgGy03kvrxhmUHdoDtACHrG0aRagFiX9nxZgZbOe6lafxgb7xGhi2wxWbpXcnB-nr6IwnqHNS2AWYvN4v4nH0WVoSuvukmW5m_SHIuYnDnwJBQwyvIXokSN9uc74buo9tluijoGHgrTuLLozIybU0uCSMscf7IaMsGbjqtWG-qCnfA).

## Event Sourcing Pattern

The event sourcing pattern treats transactions as events that capture changes to the system's state over time. Instead of persisting the current state of an entity, we store a sequence of events that led to that state. The current state is derived by replaying these events in sequence. This approach offers several benefits, including auditability, scalability, and flexibility.
The Calvary system accounting model tries to capture such events using Data Mapper taking advantage of the inherent flexibility of the system to store records in the database. To get current positions the system replays the events up to a specified set of parameters, from within SQL. It is estimated that such an implementation may not be suitable for institutions with the range of 100,000 records or transactions per day. So the goal of the project is to remain
efficient in data capture to the tune of around 10,000 records per day. Anywhere beyond that and a redesign process will become necessary. 

## Design Principles

The accounting model in Calvary ERP's Treasury module adheres to the following design principles:

1. **Event-Driven Architecture**: Transactions are represented as events, which are immutable records capturing changes to the system's state.

2. **Journal Entries**: Each transaction in the Treasury module results in journal entries that record the debit and credit aspects of the transaction. These journal entries form the basis for maintaining accurate financial records.

3. **Immutable Events**: Once an event is recorded, it cannot be modified or deleted. This ensures a reliable audit trail and facilitates error correction through compensating events.

4. **Temporal Modeling**: Events are timestamped to preserve the temporal order of transactions. This allows for accurate reconstruction of the system's state at any point in time.

5. **Projection-based Querying**: To derive the current state of an account or financial report, we use projection functions to process and aggregate events. This separation of concerns enables efficient querying and reporting.

## Implementation Details

The accounting model in Calvary ERP's Treasury module is implemented using a combination of event sourcing and CQRS (Command Query Responsibility Segregation) principles. Here are some key components and concepts:

1. **Event Store**: All events generated by transactions are persisted in an event store, which serves as the system of record for financial transactions.

2. **Command Handlers**: Commands representing financial transactions are processed by command handlers, which validate the commands and produce corresponding events.

3. **Event Handlers**: Events are consumed by event handlers, which update the read models used for querying and reporting.

4. **Projection Functions**: Projection functions transform events into denormalized views optimized for querying specific aspects of financial data, such as account balances or financial statements.

5. **Domain Entities**: Domain entities represent concepts such as accounts, transactions, and ledger entries. These entities encapsulate business logic and enforce invariants.

## Similarities with Book-Keeper Project

The approach to event sourcing and accounting in Calvary ERP's Treasury module shares similarities with the Book-Keeper project by ghacupha. Both projects leverage the event sourcing pattern to capture financial transactions as immutable events and derive the current state through event replay.

## Domain Entities in Calvary ERP's Treasury Module

In the Treasury module of Calvary ERP, various domain entities are crucial for managing financial transactions and maintaining accurate records. Let's enumerate these entities and briefly describe their roles within the accounting model:

### 1. Transaction-Account

- **Description**: Represents the account itself, serving as a label or identifier for the transactions associated with it.
- **Characteristics**: Non-stateful object, used for categorizing transactions.
- **Role**: Provides a way to organize and track financial activities within the system.

### 2. Account-Transaction

- **Description**: Represents a group of related entries within an account.
- **Characteristics**: Aggregates transaction entries that impact the same account.
- **Role**: Helps in organizing and summarizing the flow of funds into and out of an account.

### 3. Transaction Entry

- **Description**: Represents a debit or credit entry into an account.
- **Characteristics**: Contains details such as amount, description, timestamp, and reference to the associated transaction.
- **Role**: Records the specific impact of a financial transaction on an account's balance.

### 4. Accounting Event

- **Description**: Represents the translation of transactions from other models into the accounting format. An example of this is the Sales Receipt model which is similar to the you would see on Quickbooks or any accounting system that abstracts the complexity of accounting behind business documents like, invoices, sales receipts, bills, purchase orders and so on and so forth.
- **Characteristics**: Captures changes to the system's state resulting from external events or actions.
- **Role**: Facilitates the integration of transactions from various sources into the accounting system.

These domain entities work together to capture, organize, and process financial transactions within the Treasury module of Calvary ERP. By maintaining a clear separation of concerns and following domain-driven design principles, we ensure a robust and flexible accounting model that meets the needs of our users.


## Business Documents in Calvary ERP's Treasury Module

In addition to the core accounting model, Calvary ERP's Treasury module incorporates the concept of business documents to facilitate the entry and management of financial transactions. These documents resemble familiar forms such as sales receipts, invoices, purchase orders, bills, and payment receipts, similar to those found in accounting software like QuickBooks. The use of business documents simplifies data entry and enables non-accountant volunteers to interact with the system more intuitively. Let's explore the key types of business documents supported in Calvary ERP:

### 1. Sales Receipt

- **Purpose**: Documents the sale of goods or services to customers.
- **Content**: Includes details such as customer information, items sold, prices, and payment details.
- **Function**: Generates a record of revenue and updates relevant accounts receivable balances.

### 2. Invoice

- **Purpose**: Requests payment for goods or services provided to customers.
- **Content**: Contains information about the seller, buyer, items or services provided, prices, and payment terms.
- **Function**: Initiates accounts receivable transactions and serves as a billing statement for customers.

### 3. Payment Receipt

- **Purpose**: Acknowledges receipt of payment from customers or donors.
- **Content**: Lists details of the payment, including amount, date, payer information, and payment method.
- **Function**: Records revenue and updates accounts receivable balances accordingly.

### 4. Purchase Order

- **Purpose**: Requests goods or services from vendors or suppliers.
- **Content**: Specifies the items or services needed, quantities, prices, delivery details, and terms of purchase.
- **Function**: Initiates accounts payable transactions and serves as a purchasing authorization document.

### 5. Bill

- **Purpose**: Documents the receipt of goods or services from vendors or suppliers.
- **Content**: Contains information about the seller, buyer, items or services received, prices, and payment terms.
- **Function**: Records expenses and updates accounts payable balances.

### 6. Bill Settlement

- **Purpose**: Records the payment made to settle outstanding bills or invoices.
- **Content**: Lists the bills or invoices being paid, payment amounts, dates, and payment methods.
- **Function**: Updates accounts payable balances and marks bills or invoices as paid.

### Integration with the Accounting Model

Business documents in Calvary ERP's Treasury module interact with the core accounting model through the Accounting Event object. When a business document is created or modified, it triggers the generation of accounting events, which are then processed by the accounting model to update the appropriate accounts and financial records. This integration ensures that financial information flows seamlessly from business documents to the accounting system, providing accurate and up-to-date financial reporting.

By leveraging the concept of business documents, Calvary ERP enables non-accountant volunteers to participate in financial management tasks with ease, fostering greater adoption and collaboration within church communities.

## Conclusion

The accounting model in Calvary ERP's Treasury module offers a robust and scalable foundation for managing financial transactions and maintaining accurate financial records. By embracing the event sourcing pattern and leveraging domain-driven design principles, we ensure auditability, scalability, and flexibility in our accounting system.

If you have any questions or require further clarification on the accounting model, please don't hesitate to reach out to the development team.

Thank you for your interest in Calvary ERP's Treasury module accounting model!

Best Regards,

Editorial

Calvary Systems

```Insights at the speed of the message```
